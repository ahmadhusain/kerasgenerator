<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Generator for Time Series Models • kerasgenerator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Data Generator for Time Series Models">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kerasgenerator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/timeseries.html">Data Generator for Time Series Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bagasbgy/kerasgenerator">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Data Generator for Time Series Models</h1>
                        <h4 class="author">R. Dimas Bagas Herlambang</h4>
            
            <h4 class="date">Last updated on: January 6, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bagasbgy/kerasgenerator/blob/master/vignettes/timeseries.Rmd"><code>vignettes/timeseries.Rmd</code></a></small>
      <div class="hidden name"><code>timeseries.Rmd</code></div>

    </div>

    
    
<p>Preparing a proper dataset for a supervised time series model in R sometimes could become very complex and tedious. There are some tutorials that already cover this kind of task: check out the tutorial made by <a href="https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/">Dancho and Keydana</a> <span class="citation">(<a href="#ref-dancho2018predicting">2018</a>)</span> for basic univariate model fitting without using data generator, and the one made by <a href="https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/">Chollet and Allaire</a> <span class="citation">(<a href="#ref-chollet2017time">2017</a>)</span> for the multivariate model with a custom data generator. However, as you could see from the articles, there are no general framework on how to properly do the data preparation process.</p>
<p>In this article we will show you how <code>kerasgenerator</code> could help us in preparing a data generator for supervised time series <a href="https://keras.rstudio.com"><code>keras</code></a> models.</p>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Understanding the Time Series Array Shape</h1>
<p>To fit a supervised time series model, many of <code>keras</code>’ functions expect the target and feature data to be in an <code>array</code> object with a specific number of dimension. The input and output <code>array</code> need to have at least three dimension that representing:</p>
<ol style="list-style-type: decimal">
<li>Observation index</li>
<li>Number of timesteps</li>
<li>Number of distinct feature / target</li>
</ol>
<p>To understand better what each dimensions representing, let’s follow a quick example using the popular <a href="https://datamarket.com/data/set/232n/internet-traffic-data-in-bits-from-a-private-isp-with-centres-in-11-european-cities-the-data-corresponds-to-a-transatlantic-link-and-was-collected-from-0657-hours-on-7-june-to-1117-hours-on-31-july-2005-data-collected-at-five-minute-intervals#!ds=232n&amp;display=line">Internet Traffic Data from 11 European Cities</a> dataset, provided by Time Series Data Library <span class="citation">(<span class="citeproc-not-found" data-reference-id="hyndman"><strong>???</strong></span> <span class="citation">@2019time</span>)</span>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># import dataset</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">traffic_tbl &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="dt">file =</span> <span class="st">"data/internet-traffic-data-in-bits-fr.csv"</span>,</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  <span class="dt">col_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"datetime"</span>, <span class="st">"traffic"</span>),</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  <span class="dt">skip =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># delete last row which contain NA</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">traffic_tbl <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(.))</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co"># quick check</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="kw">glimpse</span>(traffic_tbl)</a></code></pre></div>
<pre><code>## Observations: 14,772
## Variables: 2
## $ datetime &lt;dttm&gt; 2005-06-07 07:00:00, 2005-06-07 07:05:00, 2005-06-07 0…
## $ traffic  &lt;dbl&gt; 3562279127, 3710215571, 3877469703, 3876354871, 4582542…</code></pre>
<p>The dataset is in a general time series format–it contains a time identifier column, each row representing a timestep, and it is regularly ordered. Let’s see the time series pattern for the last 7 days in the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(scales)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyquant)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># plot the last 7 days</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">traffic_tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">24</span> <span class="op">*</span><span class="st"> </span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> datetime, <span class="dt">y =</span> traffic)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">    </span><span class="kw">scale_x_datetime</span>(<span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/scales/topics/date_format">date_format</a></span>(<span class="st">"%a, %b %e, %H:%M:%S"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">    </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">      <span class="dt">label =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/scales/topics/number_format">unit_format</a></span>(<span class="dt">unit =</span> <span class="st">"M"</span>, <span class="dt">scale =</span> <span class="fl">1e-09</span>, <span class="dt">accuracy =</span> <span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidyquant/topics/theme_tq">theme_tq</a></span>()</a></code></pre></div>
<p><img src="timeseries_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>In supervised time series model, we need to define two important parameters for our datasets. The first parameter is the <strong>lookback period</strong>. The lookback period is determining <strong>how many period behind should the targets look-up for its signal</strong>, but it should be noted that <strong>the periods in-between will be skipped</strong>. The second parameter is the <strong>timestep length</strong>. This parameter define <strong>the length of an observation of features</strong> that would be considered as a sequence of signal for the target. <strong>Note</strong> that the terms that I just mentioned might be differ from other source, but I really suggest you to read the original paper of <a href="https://www.bioinf.jku.at/publications/older/2604.pdf">Long Short-Term Memory</a> layer <span class="citation">(Hochreiter &amp; Schmidhuber, <a href="#ref-hochreiter1997long">1997</a>)</span> and other valid sources to reach a better understanding of the terminologies.</p>
<p>Now let’s make some illustration using our dataset to make it clear. Supposed that we want to predict the value of 5-minutes total traffic using the traffic pattern in the previous hour. If, we pick the last observation of our dataset as our target, then the target and features will be:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># set some parameters</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">lookback &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">timesteps &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># specify the target and feature</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">target &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(traffic_tbl<span class="op">$</span>datetime, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">feature_end &lt;-<span class="st"> </span>target <span class="op">-</span><span class="st"> </span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">minutes</a></span>(lookback)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">feature_start &lt;-<span class="st"> </span>feature_end <span class="op">-</span><span class="st"> </span><span class="dv">5</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">minutes</a></span>(timesteps) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">minutes</a></span>(<span class="dv">5</span>)</a></code></pre></div>
<p>Notice that I set the <code>feature_start</code> to be <code>feature_end - timesteps + 1</code>–the <code>+ 1</code> is represented by <code><a href="http://lubridate.tidyverse.org/reference/period.html">minutes(5)</a></code> in this case. This is because the <code>timesteps</code> value is representing how long is our feature–without <code>+ 1</code>, the timesteps would be longer by 1 value. See the following figure for an illustration:</p>
<div class="figure" style="text-align: center">
<img src="timeseries_files/figure-html/unnamed-chunk-4-1.png" alt="Supervised time series model illustration" width="100%"><p class="caption">
Supervised time series model illustration
</p>
</div>
<p>If we follow this format, then we could convert the data into <code>array</code> matrices like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># container arrays</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">x_array &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">array</a></span>(<span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, timesteps, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">y_array &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">array</a></span>(<span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co"># specify the row indices</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">y_row &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(traffic_tbl)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">x_row &lt;-<span class="st"> </span>y_row <span class="op">-</span><span class="st"> </span>lookback</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co"># adjust the x indices according to the timesteps</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">x_indices &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  <span class="dt">from =</span> x_row <span class="op">-</span><span class="st"> </span>timesteps <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  <span class="dt">to =</span> x_row</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co"># convert the table into matrix</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16">traffic_matrix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.matrix">data.matrix</a></span>(traffic_tbl)</a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co"># fill the arrays</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19">x_array[<span class="dv">1</span>, , <span class="dv">1</span>] &lt;-<span class="st"> </span>traffic_matrix[x_indices, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">y_array[<span class="dv">1</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span>traffic_matrix[y_row, <span class="dv">2</span>]</a></code></pre></div>
<p>Let’s confirm the structure and content inside the arrays:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># check the structure</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(x_array)</a></code></pre></div>
<pre><code>##  num [1, 1:12, 1] 6.14e+09 6.25e+09 6.29e+09 6.24e+09 6.34e+09 ...</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(y_array)</a></code></pre></div>
<pre><code>##  num [1, 1] 6.61e+09</code></pre>
<p>Basically, the <a href="/reference/series_generator"><code><a href="../reference/series_generator.html">series_generator()</a></code></a> function is transforming your data into the format similar to above explanation; <a href="(/reference/forecast_generator)"><code><a href="../reference/forecast_generator.html">forecast_generator()</a></code></a> also works in a similar way, but disregards any attributes related to <code>y</code> (see <a href="#forecast">forecasting section</a> for further explanation). Let’s take a look on how those functions in action in the following sections.</p>
</div>
<div id="fitting" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting" class="anchor"></a>Fitting a Time Series Model using Data Generator</h1>
<p>In this example, we will continue using the Internet Traffic dataset to fit a time series Keras model using <code>kerasgenerator</code>.</p>
<p>To build a time series data generator, we need to specify some parameters:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># the x and y index</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">x &lt;-<span class="st"> "traffic"</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">y &lt;-<span class="st"> "traffic"</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># supervised parameter</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">lookback &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">timesteps &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co"># dataset settings</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">train_length &lt;-<span class="st"> </span><span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">24</span> <span class="op">*</span><span class="st"> </span><span class="dv">7</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">val_length &lt;-<span class="st"> </span><span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">24</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">batch_size &lt;-<span class="st"> </span><span class="dv">12</span> <span class="op">*</span><span class="st"> </span><span class="dv">24</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co"># train-val row indices</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15">val_end &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(traffic_tbl)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">val_start &lt;-<span class="st"> </span>val_end <span class="op">-</span><span class="st"> </span>val_length <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"></a>
<a class="sourceLine" id="cb10-18" data-line-number="18">train_end &lt;-<span class="st"> </span>val_start <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19">train_start &lt;-<span class="st"> </span>train_end <span class="op">-</span><span class="st"> </span>train_length <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co"># number of steps to see full data</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22">train_steps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">ceiling</a></span>(train_length <span class="op">/</span><span class="st"> </span>batch_size)</a>
<a class="sourceLine" id="cb10-23" data-line-number="23">val_steps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">ceiling</a></span>(val_length <span class="op">/</span><span class="st"> </span>batch_size)</a></code></pre></div>
<p>Before we continue, let’s define a custom function for data preprocessing on the fly. We will use <a href="https://tidymodels.github.io/recipes/"><code>recipes</code></a> functionality within our custom function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(recipes)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># recipe: square root, center, scale</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">recipe_obj &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/recipe">recipe</a></span>(traffic <span class="op">~</span><span class="st"> </span>., traffic_tbl[train_start<span class="op">:</span>train_end, ]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/step_sqrt">step_sqrt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/has_role">all_outcomes</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/step_center">step_center</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/has_role">all_outcomes</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/step_scale">step_scale</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/has_role">all_outcomes</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/prep">prep</a></span>()</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co"># custom preprocess function</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">prep_funs &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  <span class="co"># preprocess</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">  newdata &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/recipes/topics/bake">bake</a></span>(</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    <span class="dt">object =</span> recipe_obj,</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    <span class="dt">new_data =</span> data</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  )</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  <span class="co"># return the data</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(newdata)</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb11-22" data-line-number="22">}</a></code></pre></div>
<p>Finally, we could start to make generators for the train and validation data:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(kerasgenerator)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># data generator</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">train_gen &lt;-<span class="st"> </span><span class="kw"><a href="../reference/series_generator.html">series_generator</a></span>(</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="dt">data =</span> traffic_tbl,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="dt">lookback =</span> lookback,</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="dt">timesteps =</span> timesteps,</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="dt">start_index =</span> train_start,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="dt">end_index =</span> train_end,</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">  <span class="dt">batch_size =</span> batch_size,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  <span class="dt">return_target =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  <span class="dt">prep_funs =</span> prep_funs</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb12-17" data-line-number="17"></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">val_gen &lt;-<span class="st"> </span><span class="kw"><a href="../reference/series_generator.html">series_generator</a></span>(</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">  <span class="dt">data =</span> traffic_tbl,</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">  <span class="dt">y =</span> y,</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">  <span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb12-22" data-line-number="22">  <span class="dt">lookback =</span> lookback,</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">  <span class="dt">timesteps =</span> timesteps,</a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  <span class="dt">start_index =</span> val_start,</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">  <span class="dt">end_index =</span> val_end,</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">  <span class="dt">batch_size =</span> batch_size,</a>
<a class="sourceLine" id="cb12-27" data-line-number="27">  <span class="dt">return_target =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb12-28" data-line-number="28">  <span class="dt">prep_funs =</span> prep_funs</a>
<a class="sourceLine" id="cb12-29" data-line-number="29">)</a></code></pre></div>
<p>Now we can proceed to define our time series Keras model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(keras)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># initiate a sequential model</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/keras_model_sequential">keras_model_sequential</a></span>()</a>
<a class="sourceLine" id="cb13-6" data-line-number="6"></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># define the model</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="st">  </span><span class="co"># layer lstm</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/layer_lstm">layer_lstm</a></span>(</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    <span class="dt">name =</span> <span class="st">"lstm1"</span>,</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="dt">input_shape =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(timesteps, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x)),</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    <span class="dt">units =</span> <span class="dv">128</span>,</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">    <span class="dt">dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    <span class="dt">recurrent_dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    <span class="dt">return_sequences =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="st">  </span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/layer_lstm">layer_lstm</a></span>(</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">    <span class="dt">name =</span> <span class="st">"lstm2"</span>,</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">    <span class="dt">units =</span> <span class="dv">64</span>,</a>
<a class="sourceLine" id="cb13-23" data-line-number="23">    <span class="dt">dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">    <span class="dt">recurrent_dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    <span class="dt">return_sequences =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="st">  </span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/layer_lstm">layer_lstm</a></span>(</a>
<a class="sourceLine" id="cb13-29" data-line-number="29">    <span class="dt">name =</span> <span class="st">"lstm3"</span>,</a>
<a class="sourceLine" id="cb13-30" data-line-number="30">    <span class="dt">units =</span> <span class="dv">32</span>,</a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    <span class="dt">dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">    <span class="dt">recurrent_dropout =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb13-33" data-line-number="33">    <span class="dt">return_sequences =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35"><span class="st">  </span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36"><span class="st">  </span><span class="co"># layer output</span></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/layer_dense">layer_dense</a></span>(</a>
<a class="sourceLine" id="cb13-38" data-line-number="38">    <span class="dt">name =</span> <span class="st">"output"</span>,</a>
<a class="sourceLine" id="cb13-39" data-line-number="39">    <span class="dt">units =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(y)</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">  )</a>
<a class="sourceLine" id="cb13-41" data-line-number="41"></a>
<a class="sourceLine" id="cb13-42" data-line-number="42"><span class="co"># compile the model</span></a>
<a class="sourceLine" id="cb13-43" data-line-number="43">model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/reexports">compile</a></span>(</a>
<a class="sourceLine" id="cb13-44" data-line-number="44">  <span class="dt">optimizer =</span> <span class="st">"rmsprop"</span>,</a>
<a class="sourceLine" id="cb13-45" data-line-number="45">  <span class="dt">loss =</span> <span class="st">"mse"</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46">)</a>
<a class="sourceLine" id="cb13-47" data-line-number="47"></a>
<a class="sourceLine" id="cb13-48" data-line-number="48"><span class="co"># model summary</span></a>
<a class="sourceLine" id="cb13-49" data-line-number="49"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model)</a></code></pre></div>
<pre><code>## ___________________________________________________________________________
## Layer (type)                     Output Shape                  Param #     
## ===========================================================================
## lstm1 (LSTM)                     (None, 12, 128)               66560       
## ___________________________________________________________________________
## lstm2 (LSTM)                     (None, 12, 64)                49408       
## ___________________________________________________________________________
## lstm3 (LSTM)                     (None, 32)                    12416       
## ___________________________________________________________________________
## output (Dense)                   (None, 1)                     33          
## ===========================================================================
## Total params: 128,417
## Trainable params: 128,417
## Non-trainable params: 0
## ___________________________________________________________________________</code></pre>
<p>To fit this model, we will use <a href="(https://keras.rstudio.com/reference/fit_generator.html)"><code><a href="https://www.rdocumentation.org/packages/keras/topics/fit_generator">fit_generator()</a></code></a> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># set number of epochs</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">epochs &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># model fitting</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">history &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/fit_generator">fit_generator</a></span>(</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="dt">generator =</span> train_gen,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  <span class="dt">steps_per_epoch =</span> train_steps,</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  <span class="dt">epochs =</span> epochs,</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">  <span class="dt">validation_data =</span> val_gen,</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">  <span class="dt">validation_steps =</span> val_steps</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb15-12" data-line-number="12"></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co"># history plot</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(history)</a></code></pre></div>
<p><img src="timeseries_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>You can also pass the generator to <a href="(https://keras.rstudio.com/reference/evaluate_generator.html)"><code><a href="https://www.rdocumentation.org/packages/keras/topics/evaluate_generator">evaluate_generator()</a></code></a> to evaluate the results:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># evaluate on validation dataset</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/evaluate_generator">evaluate_generator</a></span>(</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">generator =</span> val_gen,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="dt">steps =</span> val_steps</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">)</a></code></pre></div>
<pre><code>##       loss 
## 0.05479006</code></pre>
</div>
<div id="forecast" class="section level1">
<h1 class="hasAnchor">
<a href="#forecast" class="anchor"></a>Forecasting using Data Generator</h1>
<p>Like in <a href="/reference/series_generator"><code><a href="../reference/series_generator.html">series_generator()</a></code></a> function, we need to specify some parameters for <a href="/reference/forecast_generator"><code><a href="../reference/forecast_generator.html">forecast_generator()</a></code></a>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># forecast horizon</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">horizon &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co"># forecast indices</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">last_index &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(traffic_tbl)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co"># number of steps to see full data</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">fcast_steps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">ceiling</a></span>(horizon <span class="op">/</span><span class="st"> </span>batch_size)</a></code></pre></div>
<p>Note that the <strong>forecast <code>horizon</code> should not be greater than the value of <code>lookback</code> if you want to forecast from the last observation</strong>.</p>
<p>Then, we can proceed to define the generator and pass it to <a href="(https://keras.rstudio.com/reference/predict_generator.html)"><code><a href="https://www.rdocumentation.org/packages/keras/topics/predict_generator">predict_generator()</a></code></a> function:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># forecast generator</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">fcast_gen &lt;-<span class="st"> </span><span class="kw"><a href="../reference/forecast_generator.html">forecast_generator</a></span>(</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">data =</span> traffic_tbl,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">x =</span> x,</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  <span class="dt">lookback =</span> lookback,</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="dt">timesteps =</span> timesteps,</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">  <span class="dt">last_index =</span> last_index,</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">  <span class="dt">horizon =</span> horizon,</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">  <span class="dt">batch_size =</span> batch_size</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co"># forecast using generator</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13">fcast &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/keras/topics/predict_generator">predict_generator</a></span>(</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">  <span class="dt">generator =</span> fcast_gen,</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  <span class="dt">steps =</span> fcast_steps</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb19-17" data-line-number="17"></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co"># check the structure</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(fcast)</a></code></pre></div>
<pre><code>##  num [1:12, 1] 2.75 2.75 2.75 2.75 2.75 ...</code></pre>
</div>
<div id="reference" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#reference" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-chollet2017time">
<p>Chollet, F., &amp; Allaire, J. (2017). TensorFlow for r: Time series forecasting with recurrent neural networks. Retrieved from <a href="https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/" class="uri">https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/</a></p>
</div>
<div id="ref-dancho2018predicting">
<p>Dancho, M., &amp; Keydana, S. (2018). TensorFlow for r: Predicting sunspot frequency with keras. Retrieved from <a href="https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/" class="uri">https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/</a></p>
</div>
<div id="ref-hochreiter1997long">
<p>Hochreiter, S., &amp; Schmidhuber, J. (1997). Long short-term memory. <em>Neural Computation</em>, <em>9</em>(8), 1735–1780.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Understanding the Time Series Array Shape</a></li>
      <li><a href="#fitting">Fitting a Time Series Model using Data Generator</a></li>
      <li><a href="#forecast">Forecasting using Data Generator</a></li>
      <li><a href="#reference">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://bagasbgy.netlify.com">R. Dimas Bagas Herlambang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
