<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Generator for Time Series Models • kerasgenerator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Data Generator for Time Series Models">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kerasgenerator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/timeseries.html">Data Generator for Time Series Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bagasbgy/kerasgenerator">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Data Generator for Time Series Models</h1>
                        <h4 class="author">R. Dimas Bagas Herlambang</h4>
            
            <h4 class="date">Last updated on: January 2, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bagasbgy/kerasgenerator/blob/master/vignettes/timeseries.Rmd"><code>vignettes/timeseries.Rmd</code></a></small>
      <div class="hidden name"><code>timeseries.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level1">
<h1 class="hasAnchor">
<a href="#intro" class="anchor"></a>Introduction to Data Generator for Time Series Model</h1>
<p>Preparing a proper dataset for a supervised time series model sometimes could become very complex and tedious. There are some tutorials that already cover this kind of task: check out the tutorial made by <a href="https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/">Dancho and Keydana</a> <span class="citation">(<a href="#ref-dancho2018predicting">2018</a>)</span> for basic univariate model fitting without using data generator, and the one made by <a href="https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/">Chollet and Allaire</a> <span class="citation">(<a href="#ref-chollet2017time">2017</a>)</span> for the multivariate model with a custom data generator. However, as you could see from the articles, there are no general framework on how to properly do the data preparation process.</p>
<p>In this article we will show you how <code>kerasgenerator</code> could help us in preparing a data generator for supervised time series <a href="https://keras.rstudio.com"><code>keras</code></a> models.</p>
<div id="understanding-the-time-series-array-shape" class="section level2">
<h2 class="hasAnchor">
<a href="#understanding-the-time-series-array-shape" class="anchor"></a>Understanding the Time Series Array Shape</h2>
<p>To fit a supervised time series model, many of <code>keras</code>’ functions expect the target and feature data to be in an <code>array</code> object with a specific number of dimension. The input and output <code>array</code> need to have at least three dimension that representing:</p>
<ol style="list-style-type: decimal">
<li>Observation index</li>
<li>Number of timesteps</li>
<li>Number of distinct feature / target</li>
</ol>
<p>You can imagine the <code>array</code> shape to be like this:</p>
<!-- insert image -->
<p>To understand better what each dimensions representing, let’s follow a quick example using the popular <a href="http://www.sidc.be/silso/datafiles">Sunspots</a> dataset <span class="citation">(SILSO World Data Center, <a href="#ref-sidc">2018</a>)</span>. We will use the monthly total mean version:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># import dataset</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">sunspot_tbl &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="st">"data/SN_m_tot_V2.0.csv"</span>, <span class="dt">delim =</span> <span class="st">";"</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># quick check</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">glimpse</span>(sunspot_tbl)</a></code></pre></div>
<pre><code>## Observations: 3,239
## Variables: 7
## $ X1 &lt;dbl&gt; 1749, 1749, 1749, 1749, 1749, 1749, 1749, 1749, 1749, 1749, 1…
## $ X2 &lt;chr&gt; "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "…
## $ X3 &lt;dbl&gt; 1749.042, 1749.123, 1749.204, 1749.288, 1749.371, 1749.455, 1…
## $ X4 &lt;chr&gt; "  96.7", " 104.3", " 116.7", "  92.8", " 141.7", " 139.2", "…
## $ X5 &lt;chr&gt; " -1.0", " -1.0", " -1.0", " -1.0", " -1.0", " -1.0", " -1.0"…
## $ X6 &lt;chr&gt; "   -1", "   -1", "   -1", "   -1", "   -1", "   -1", "   -1"…
## $ X7 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<p>The dataset is in a general time series format–it contains a time identifier column, each row representing a timestep, and it is regularly ordered. Before we move further, let’s do a quick data preprocess:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lubridate)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># data preprocess</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">sunspot_tbl <span class="op">%&lt;&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  </span><span class="co"># select and rename relevant variables</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(<span class="dt">year =</span> X1, <span class="dt">month =</span> X2, <span class="dt">sunspots =</span> X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">  </span><span class="co"># some data manipulation</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    <span class="dt">date =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(year, month, <span class="st">"01"</span>, <span class="dt">sep =</span> <span class="st">"-"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(),</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="dt">sunspots =</span> <span class="kw">str_squish</span>(sunspots) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>()</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">  </span><span class="co"># keep only relevant variables</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">  </span><span class="kw">select</span>(date, sunspots)</a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co"># quick check</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="kw">glimpse</span>(sunspot_tbl)</a></code></pre></div>
<pre><code>## Observations: 3,239
## Variables: 2
## $ date     &lt;date&gt; 1749-01-01, 1749-02-01, 1749-03-01, 1749-04-01, 1749-0…
## $ sunspots &lt;dbl&gt; 96.7, 104.3, 116.7, 92.8, 141.7, 139.2, 158.0, 110.5, 1…</code></pre>
<p>In supervised time series model, we need to define two important parameters for our datasets. The first parameter is the <strong>lookback period</strong>. The lookback period is determining <strong>how many period behind should the targets look-up for its signal</strong>, but it should be noted that <strong>the periods in-between will be skipped</strong>. The second parameter is the <strong>timestep length</strong>. This parameter define <strong>the length of an observation of features</strong> that would be considered as a sequence of signal for the target. <strong>Note</strong> that the terms that I just mentioned might be differ from other source, but I really suggest you to read the original paper of <a href="https://www.bioinf.jku.at/publications/older/2604.pdf">Long Short-Term Memory</a> layer <span class="citation">(Hochreiter &amp; Schmidhuber, <a href="#ref-hochreiter1997long">1997</a>)</span> and other valid sources to reach a better understanding of the terminologies.</p>
<p>Now let’s make some illustration using our dataset to make it clear. Supposed that we want to predict the value of current mean total sunspots using the value from the same month in the previous year, but we also want to consider the yearly seasonality–hence, a 12-months sequence. Say, we pick the last observation of our dataset–the mean total sunspots in December 2018–as our target, then we can illustrate the model like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># import libs</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyquant)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># set some parameters</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">lookback &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">timesteps &lt;-<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># specify the target and feature</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">target &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(sunspot_tbl<span class="op">$</span>date, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">feature_end &lt;-<span class="st"> </span>target <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">months</a></span>(lookback)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">feature_start &lt;-<span class="st"> </span>feature_end <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">months</a></span>(timesteps) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">months</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co"># illustration</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">sunspot_tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="dv">30</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    <span class="dt">label =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">      date <span class="op">==</span><span class="st"> </span>target <span class="op">~</span><span class="st"> "Target"</span>,</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">      date <span class="op">&gt;=</span><span class="st"> </span>feature_start <span class="op">&amp;</span><span class="st"> </span>date <span class="op">&lt;=</span><span class="st"> </span>feature_end <span class="op">~</span><span class="st"> "Feature"</span>,</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">      date <span class="op">&gt;</span><span class="st"> </span>feature_end <span class="op">&amp;</span><span class="st"> </span>date <span class="op">&lt;</span><span class="st"> </span>target <span class="op">~</span><span class="st"> "Skipped"</span>,</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">      <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> "Ignored"</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22">    )</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> sunspots)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> label)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">      <span class="dt">geom =</span> <span class="st">"text"</span>,</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">      <span class="dt">x =</span> target,</a>
<a class="sourceLine" id="cb5-30" data-line-number="30">      <span class="dt">y =</span> <span class="fl">16.5</span>,</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">      <span class="dt">label =</span> <span class="st">"Target"</span>,</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">      <span class="dt">colour =</span> <span class="st">"#e31a1c"</span>,</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">      <span class="dt">hjust =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">      <span class="dt">angle =</span> <span class="dv">90</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-37" data-line-number="37">      <span class="dt">geom =</span> <span class="st">"segment"</span>,</a>
<a class="sourceLine" id="cb5-38" data-line-number="38">      <span class="dt">x =</span> target,</a>
<a class="sourceLine" id="cb5-39" data-line-number="39">      <span class="dt">xend =</span> target,</a>
<a class="sourceLine" id="cb5-40" data-line-number="40">      <span class="dt">y =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb5-41" data-line-number="41">      <span class="dt">yend =</span> <span class="fl">7.5</span>,</a>
<a class="sourceLine" id="cb5-42" data-line-number="42">      <span class="dt">colour =</span> <span class="st">"#e31a1c"</span>,</a>
<a class="sourceLine" id="cb5-43" data-line-number="43">      <span class="dt">arrow =</span> <span class="kw">arrow</span>()</a>
<a class="sourceLine" id="cb5-44" data-line-number="44">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-45" data-line-number="45"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-46" data-line-number="46">      <span class="dt">geom =</span> <span class="st">"text"</span>,</a>
<a class="sourceLine" id="cb5-47" data-line-number="47">      <span class="dt">x =</span> target,</a>
<a class="sourceLine" id="cb5-48" data-line-number="48">      <span class="dt">y =</span> <span class="dv">20</span>,</a>
<a class="sourceLine" id="cb5-49" data-line-number="49">      <span class="dt">label =</span> <span class="st">"Lookback to"</span>,</a>
<a class="sourceLine" id="cb5-50" data-line-number="50">      <span class="dt">colour =</span> <span class="st">"#18BC9C"</span>,</a>
<a class="sourceLine" id="cb5-51" data-line-number="51">      <span class="dt">hjust =</span> <span class="fl">1.25</span></a>
<a class="sourceLine" id="cb5-52" data-line-number="52">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-53" data-line-number="53"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-54" data-line-number="54">      <span class="dt">geom =</span> <span class="st">"segment"</span>,</a>
<a class="sourceLine" id="cb5-55" data-line-number="55">      <span class="dt">x =</span> target <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">months</a></span>(<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb5-56" data-line-number="56">      <span class="dt">xend =</span> feature_end <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(<span class="dv">15</span>),</a>
<a class="sourceLine" id="cb5-57" data-line-number="57">      <span class="dt">y =</span> <span class="fl">17.5</span>,</a>
<a class="sourceLine" id="cb5-58" data-line-number="58">      <span class="dt">yend =</span> <span class="fl">17.5</span>,</a>
<a class="sourceLine" id="cb5-59" data-line-number="59">      <span class="dt">colour =</span> <span class="st">"#18BC9C"</span>,</a>
<a class="sourceLine" id="cb5-60" data-line-number="60">      <span class="dt">arrow =</span> <span class="kw">arrow</span>()</a>
<a class="sourceLine" id="cb5-61" data-line-number="61">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-62" data-line-number="62"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-63" data-line-number="63">      <span class="dt">geom =</span> <span class="st">"text"</span>,</a>
<a class="sourceLine" id="cb5-64" data-line-number="64">      <span class="dt">x =</span> feature_start,</a>
<a class="sourceLine" id="cb5-65" data-line-number="65">      <span class="dt">y =</span> <span class="fl">47.5</span>,</a>
<a class="sourceLine" id="cb5-66" data-line-number="66">      <span class="dt">label =</span> <span class="st">"Feature with 12 timesteps"</span>,</a>
<a class="sourceLine" id="cb5-67" data-line-number="67">      <span class="dt">colour =</span> <span class="st">"#1f78b4"</span>,</a>
<a class="sourceLine" id="cb5-68" data-line-number="68">      <span class="dt">hjust =</span> <span class="fl">-0.1375</span></a>
<a class="sourceLine" id="cb5-69" data-line-number="69">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-70" data-line-number="70"><span class="st">    </span><span class="kw">annotate</span>(</a>
<a class="sourceLine" id="cb5-71" data-line-number="71">      <span class="dt">geom =</span> <span class="st">"rect"</span>,</a>
<a class="sourceLine" id="cb5-72" data-line-number="72">      <span class="dt">xmin =</span> feature_start,</a>
<a class="sourceLine" id="cb5-73" data-line-number="73">      <span class="dt">xmax =</span> feature_end,</a>
<a class="sourceLine" id="cb5-74" data-line-number="74">      <span class="dt">ymin =</span> <span class="op">-</span><span class="ot">Inf</span>,</a>
<a class="sourceLine" id="cb5-75" data-line-number="75">      <span class="dt">ymax =</span> <span class="ot">Inf</span>,</a>
<a class="sourceLine" id="cb5-76" data-line-number="76">      <span class="dt">alpha =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb5-77" data-line-number="77">      <span class="dt">fill =</span> <span class="st">"#1f78b4"</span></a>
<a class="sourceLine" id="cb5-78" data-line-number="78">    ) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-79" data-line-number="79"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">""</span>, <span class="dt">colour =</span> <span class="st">""</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-80" data-line-number="80"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidyquant/topics/theme_tq">theme_tq</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-81" data-line-number="81"><span class="st">    </span><span class="kw">scale_colour_manual</span>(</a>
<a class="sourceLine" id="cb5-82" data-line-number="82">      <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb5-83" data-line-number="83">        <span class="st">"Ignored"</span> =<span class="st"> "#2c3e50"</span>,</a>
<a class="sourceLine" id="cb5-84" data-line-number="84">        <span class="st">"Feature"</span> =<span class="st"> "#1f78b4"</span>,</a>
<a class="sourceLine" id="cb5-85" data-line-number="85">        <span class="st">"Skipped"</span> =<span class="st"> "#18BC9C"</span>,</a>
<a class="sourceLine" id="cb5-86" data-line-number="86">        <span class="st">"Target"</span> =<span class="st"> "#e31a1c"</span></a>
<a class="sourceLine" id="cb5-87" data-line-number="87">      ),</a>
<a class="sourceLine" id="cb5-88" data-line-number="88">      <span class="dt">breaks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb5-89" data-line-number="89">        <span class="st">"Ignored"</span>,</a>
<a class="sourceLine" id="cb5-90" data-line-number="90">        <span class="st">"Feature"</span>,</a>
<a class="sourceLine" id="cb5-91" data-line-number="91">        <span class="st">"Skipped"</span>,</a>
<a class="sourceLine" id="cb5-92" data-line-number="92">        <span class="st">"Target"</span></a>
<a class="sourceLine" id="cb5-93" data-line-number="93">      )</a>
<a class="sourceLine" id="cb5-94" data-line-number="94">    )</a></code></pre></div>
<p><img src="timeseries_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<p>Notice that I set the <code>feature_start</code> to be <code>feature_end - months(timesteps) + months(1)</code>. This is because the <code>timesteps</code> value is representing how long is our feature–so without <code>+ 1</code>, the timesteps would be 13.</p>
<p>Basically, the <code><a href="../reference/series_generator.html">series_generator()</a></code> is transforming your data into this format; the same with <code><a href="../reference/forecast_generator.html">forecast_generator()</a></code>, but without <code>lookback</code> parameter (see <a href="#forecast">forecasting section</a> for further explanation). Let’s take a look on how those function in action in the following sections.</p>
</div>
</div>
<div id="fitting" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting" class="anchor"></a>Fitting a Time Series Model using Data Generator</h1>
</div>
<div id="forecast" class="section level1">
<h1 class="hasAnchor">
<a href="#forecast" class="anchor"></a>Forecasting using Data Generator</h1>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-chollet2017time">
<p>Chollet, F., &amp; Allaire, J. (2017). TensorFlow for r: Time series forecasting with recurrent neural networks. Retrieved from <a href="https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/" class="uri">https://blogs.rstudio.com/tensorflow/posts/2017-12-20-time-series-forecasting-with-recurrent-neural-networks/</a></p>
</div>
<div id="ref-dancho2018predicting">
<p>Dancho, M., &amp; Keydana, S. (2018). TensorFlow for r: Predicting sunspot frequency with keras. Retrieved from <a href="https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/" class="uri">https://blogs.rstudio.com/tensorflow/posts/2018-06-25-sunspots-lstm/</a></p>
</div>
<div id="ref-hochreiter1997long">
<p>Hochreiter, S., &amp; Schmidhuber, J. (1997). Long short-term memory. <em>Neural Computation</em>, <em>9</em>(8), 1735–1780.</p>
</div>
<div id="ref-sidc">
<p>SILSO World Data Center. (2018). The international sunspot number. <em>International Sunspot Number Monthly Bulletin and Online Catalogue</em>. Retrieved from <a href="http://www.sidc.be/silso/" class="uri">http://www.sidc.be/silso/</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#intro">Introduction to Data Generator for Time Series Model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#understanding-the-time-series-array-shape">Understanding the Time Series Array Shape</a></li>
      </ul>
</li>
      <li><a href="#fitting">Fitting a Time Series Model using Data Generator</a></li>
      <li><a href="#forecast">Forecasting using Data Generator</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://bagasbgy.netlify.com">R. Dimas Bagas Herlambang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
